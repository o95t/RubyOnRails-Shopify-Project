<div class="top-line">

    <%= form_tag(shipments_path, :method => "get") do %>
    <div class="filter-block">
        <label for="dateSelect">Date</label>
        <div class="filter-block-select">
         <input type="text" class="inner-select inline-block" id="datepicker">

<div style="display:none">
              <%= text_field_tag :datepicker_start_year, params[:datepicker_start_year], class: 'inner-select inline-block', id: "datepicker_start_year" %>
              <%= text_field_tag :datepicker_start_month, params[:datepicker_start_month], class: 'inner-select inline-block', id: "datepicker_start_month" %>
              <%= text_field_tag :datepicker_start_day, params[:datepicker_start_day], class: 'inner-select inline-block', id: "datepicker_start_day" %>  

                          
              <%= text_field_tag :datepicker_finish_year, params[:datepicker_finish_year], class: 'inner-select inline-block', id: "datepicker_finish_year" %>
              <%= text_field_tag :datepicker_finish_month, params[:datepicker_finish_month], class: 'inner-select inline-block', id: "datepicker_finish_month" %>
              <%= text_field_tag :datepicker_finish_day, params[:datepicker_finish_day], class: 'inner-select inline-block', id: "datepicker_finish_day" %>  
              <%= text_field_tag :datepicker_total, params[:datepicker_total], class: 'inner-select inline-block', id: "datepicker_total" %>  

</div>
          <%= image_tag("arr.png", class: "arr") %>
        </div>
    </div>

    <div class="filter-block">
        <label for="paymentStatus">Payment Status</label>
        <div class="filter-block-select paymentStatus-select">
          <input type="text" class="inner-select inline-block" id="paymentStatus" value="All">
          <%= image_tag("arr.png", class: "arr") %>
        </div>

        <div class='select-show paymentStatus-select-show' >
            <ul>
                <li>
                    <label class="containerCheckbox">
                        <input class="checkbox-select-show all" type="checkbox">
                        <span class="checkmark"></span>
                    </label><p>All</p></li>
                <li>
                    <label class="containerCheckbox">
                        <input type="checkbox">
                        <span class="checkmark"></span>
                    </label><p>Paid</p></li>
                <li>
                    <label class="containerCheckbox">
                        <input type="checkbox">
                        <span class="checkmark"></span>
                    </label><p>Unpaid</p></li>
                <li>
                    <label class="containerCheckbox">
                        <input type="checkbox">
                        <span class="checkmark"></span>
                    </label><p>Cash on Delivery</p></li>
                <li>
                    <label class="containerCheckbox">
                        <input type="checkbox">
                        <span class="checkmark"></span>
                    </label><p>Pending</p></li>

            </ul>
            <div class='select-show-bottom'>	
                <div class='select-show-bottom-blocks'>
                    <p class='select-show-cancel'>Cancel</p>
                    <p class='select-show-done passive'>Done</p>
                </div>
            </div>
        </div>
    </div>

    <div class="filter-block">
        <label for="productGroupSelect">Product group</label>
        <div class="filter-block-select productGroupSelect-select">
          <input type="text" class="inner-select inline-block" id="productGroupSelect" value="All">
          <%= image_tag("arr.png", class: "arr") %>
        </div>

        <div class='select-show productGroupSelect-select-show' >
            <ul>
                <li>
                    <label class="containerCheckbox">
                        <input class="checkbox-select-show all" type="checkbox">
                        <span class="checkmark"></span>
                    </label><p>All</p></li>
                <li>
                    <label class="containerCheckbox">
                        <input type="checkbox">
                        <span class="checkmark"></span>
                    </label><p>Domestic</p></li>
                <li>
                    <label class="containerCheckbox">
                        <input type="checkbox">
                        <span class="checkmark"></span>
                    </label><p>Express</p></li>
                <li>
                    <label class="containerCheckbox">
                        <input type="checkbox">
                        <span class="checkmark"></span>
                    </label><p>Freight</p></li>
            </ul>
            <div class='select-show-bottom'>	
                <div class='select-show-bottom-blocks'>
                    <p class='select-show-cancel'>Cancel</p>
                    <p class='select-show-done passive'>Done</p>
                </div>
            </div>
        </div>
    </div>
    <div class="filter-block">
        <label for="additionalServices">Additional services</label>
        <div class="filter-block-select additionalServices-select">
          <input type="text" class="inner-select inline-block" id="additionalServices" value="All">
          <%= image_tag("arr.png", class: "arr") %>
        </div>
        <div class='select-show additionalServices-select-show' >
            <ul>
                <li>
                    <label class="containerCheckbox">
                        <input class="checkbox-select-show all" type="checkbox">
                        <span class="checkmark"></span>
                    </label><p >All</p></li>
                <li>
                    <label class="containerCheckbox">
                        <input type="checkbox">
                        <span class="checkmark"></span>
                    </label><p>COD</p></li>
                <li>
                    <label class="containerCheckbox">
                        <input type="checkbox">
                        <span class="checkmark"></span>
                    </label><p>DDU</p></li>
                <li>
                    <label class="containerCheckbox">
                        <input type="checkbox">
                        <span class="checkmark"></span>
                    </label><p>RTN</p></li>
            </ul>
            <div class='select-show-bottom'>	
                <div class='select-show-bottom-blocks'>
                    <p class='select-show-cancel'>Cancel</p>
                    <p class='select-show-done passive'>Done</p>
                </div>
            </div>
        </div>
    </div>
    <div class="filter-block-right">
        <p class="export" data-toggle="modal" data-target="#exampleModal"><%= image_tag("export.png", alt: "Aramex Logo") %>Export</p>
        <input class="main-red-button" type="button" onclick="window.location = '/shipments/new';" value="Create New Label"/>
        <input class="main-grey-button" type="button" onclick="window.location = '/pickups/new';" value="Create pickup"/>
    </div>
</div>
<div class="filter-block-tab">
    <ul class='filter-tab'>
        <li class='first first_pickedup'>
            <% unless params[:fulfillment_status] %>
                <p class="active"><%= link_to "All", shipments_path, class: 'active' %></p>
            <% else %>
                <p><%= link_to "All", shipments_path %></p>
            <% end %>
        </li>
        <li class='second second_pickedup'>
            <% if params[:fulfillment_status] == "unfulfilled" %>
                <p class="active"><%= link_to "Unfulfilled", shipments_path(fulfillment_status: 'unfulfilled'), class: 'active' %></p>
            <% else %>
                <p><%= link_to "Unfulfilled", shipments_path(fulfillment_status: 'unfulfilled') %></p>
            <% end %>
        </li>
        <li class='third third_pickedup'>  
            <% if params[:fulfillment_status] == "shipped" %>
                <p class="active"><%= link_to "Fulfilled", shipments_path(fulfillment_status: 'shipped'), class: 'active' %></p>
            <% else %>
                <p><%= link_to "Fulfilled", shipments_path(fulfillment_status: 'shipped') %></p>
            <% end %> 
        </li>
    </ul>
</div>

<div class="search-block">
    <div class="search-block-left">
        <p class='order-number'>Order Number</p>
        <p class='triangle'></p>
    </div>

    <div class="search-block-right">

        <%= image_tag("search.png", alt: "Search", class: "lupa") %>
        <%= text_field_tag :order_number, params[:order_number], class: 'search', size:40, placeholder: "Search" %>
        <%= submit_tag "Search", style: 'display:none' %>
    </div>
   
    <div>
    </div>
</div>
 <% end %>
<div class="select-block">
    <div class="select-block-left">

        <label class="containerCheckbox checkedAll-container">
            <input id="checkedAll" type="checkbox">
            <span class="checkmark"></span>
        </label>

        <p class='items-selected'><span >0</span> Selected</p>
    </div>   
    <div class="select-block-right ">
        <p class="dropdown-toggle "  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Actions</p>
        <div class="dropdown-menu">
            <a class="dropdown-item create_shipment_link" href="#">Create Shipment</a>
            <a class="dropdown-item create_pickup_link" href="#">Create Pickup</a>
            <a class="dropdown-item print_label_link" href="#">Print Label</a>
            <div role="separator" class="dropdown-divider"></div>
            <a class="dropdown-item edit_link" href="#">Edit</a>
            <a class="dropdown-item cancel_awbs" href="#">Cancel AWBs</a>
        </div>
    </div>   
</div>

<div class="table-responsive">
    <table class="table table-sm table-shipment">
        <thead>
            <tr>
                <th></th>
                <th>Order number</th>
                <th>Date</th>
                <th>Tracking Number</th>
                <th>Consignee email</th>
                <th>Last update</th>
                <th>Pickup reference</th>
                <th>Shipment Reference</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
          <% @orders.each do |order| %>
            <tr>
              <td>
                <label class="containerCheckbox">
                  <input  data-type="2879" class="checkSingle" type="checkbox" >
                  <span class="checkmark"></span>
                </label>
              </td>
              <td># <%= order.order_number %></td>
              <td><%= Date.parse(order.created_at).strftime("%d/%m/%Y")  %></td>
              <td>9871003073</td>
              <td><%= order.email %></td>
              <td><%= Date.parse(order.updated_at).strftime("%d/%m/%Y") %></td>
              <td>AX2U11a78</td>
              <td>9QA871003073</td>
              <td>
                <% if !order.fulfillment_status %>
                  <span class='red'>UnFulfilled</span>
                <% else %>
                  <span>Fulfilled</span></td>
                <% end %>        
              </td>
            </tr>
          <% end %>                                                                                                                      
        </tbody>
    </table>
    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center pagination-shipping">
            <li class="page-item">
                <%
                    if params[:page].to_i == 1 || !params[:page]
                        go_to_back = 1
                    else
                        go_to_back = params[:page].to_i - 1
                    end    
                %>
                <%= link_to "/shipments?page=#{go_to_back}", class: "page-link" do %>
                    <div class="arrow-left"></div>
                <% end %>
            </li>
            <% @count_of_pages.times do |s| %>
                <% if params[:page].to_i == s + 1 %>
                <li class="page-item active">
                <% else %>
                <li class="page-item">
                <% end %>
                    <%= link_to "#{s+1}", "/shipments?page=#{s+1}", class: "page-link" %>
                </li>
            <% end %>
            <li class="page-item">
                <%
                    if params[:page].to_i == @count_of_pages 
                        go_to_next = @count_of_pages
                    elsif !params[:page]
                        go_to_next = 2
                    else    
                        go_to_next = params[:page].to_i + 1
                    end
                %>
                <%= link_to "/shipments?page=#{go_to_next}", class: "page-link" do %>
                    <div class="arrow-right"></div>
                <% end %>
            </li>   
        </ul>
    </nav>       
</div>
<!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Export</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        ...
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn modal-button">Export</button>
                    </div>
                </div>
            </div>
        </div>
        <script>
    $(document).ready(function () {

        $(".lupa").click(function () {
            var str = getAllValues();
            window.location.href = "main.html?"+ str;
        });
/*
        $(".main-red-button").click(function () {
            event.preventDefault();
            var strFromTable = getAllValuesFromTable();
           if(strFromTable === ""){
                alert("Select orders, please.");
                return
            }
            window.location.href = "main.html?"+ strFromTable;
        });

        $(".main-grey-button").click(function () {
            event.preventDefault();
            var strFromTable = getAllValuesFromTable();
           if(strFromTable === ""){
                alert("Select orders, please.");
                return
            }
            window.location.href = "main.html?"+ strFromTable;
        });
        */
        $(".create_shipment_link").click(function () {
            event.preventDefault();
            var strFromTable = getAllValuesFromTable();
           if(strFromTable === ""){
                alert("Select orders, please.");
                return
            }
            window.location.href = "main.html?"+ strFromTable;
        });

        $(".create_pickup_link").click(function () {
            event.preventDefault();
            var strFromTable = getAllValuesFromTable();
           if(strFromTable === ""){
                alert("Select orders, please.");
                return
            }
            window.location.href = "main.html?"+ strFromTable;
        });

        $(".print_label_link").click(function () {
            event.preventDefault();
            var strFromTable = getAllValuesFromTable();
           if(strFromTable === ""){
                alert("Select orders, please.");
                return
            }
            window.location.href = "main.html?"+ strFromTable;
        });

        $(".edit_link").click(function () {
            event.preventDefault();
            var strFromTable = getAllValuesFromTable();
           if(strFromTable === ""){
                alert("Select orders, please.");
                return
            }
            window.location.href = "main.html?"+ strFromTable;
        });

        $(".cancel_awbs").click(function () {
            event.preventDefault();
            var strFromTable = getAllValuesFromTable();
           if(strFromTable === ""){
                alert("Select orders, please.");
                return
            }
            window.location.href = "main.html?"+ strFromTable;
        });


        $(".first_fulfilled p").click(function () {
            clearActive();
            $(this).addClass("active");
            var str = getAllValues();
            window.location.href = "main.html?"+ str;
        });

        $(".second_fulfilled p").click(function () {
            clearActive();
            $(this).addClass("active");
            var str = getAllValues();
            window.location.href = "main.html?"+ str;
        });
        
        $(".third_fulfilled p").click(function () {
            clearActive();
            $(this).addClass("active");
            var str = getAllValues();
            window.location.href = "main.html?"+ str;
        });

        function clearActive() {
                $(".filter-tab li p").each(function () {
                    if($(this).hasClass("active")){
                        $(this).removeClass("active");
                    }
                });
        }

        function getAllValuesFromTable() {
            var tableShipment =[];
                $(".table-shipment tbody tr td input").each(function () {
                    if (this.checked) {
                        var nameInput = $(this).attr("data-type");
                        tableShipment.push(nameInput); 
                    } 
                });

            var params = "";
            for (var i = tableShipment.length - 1; i > -1; i--) {
                    params += 'operations[]='+tableShipment[i]+'&';

            };
            return params.slice(0,-1);
        }


        function getAllValues() {
            var date = $("#datepicker").val();
            var paymentStatus = $("#paymentStatus").val();
            var productGroupSelect = $("#productGroupSelect").val();
            var additionalServices = $("#additionalServices").val();
            var search = $(".search").val();
            var fulfilment;
                $(".filter-tab li p").each(function () {
                    if($(this).hasClass("active")){
                        fulfilment = $(this).text();
                    }
                })


            var params = { 
                date:encodeURIComponent(date),
                paymentStatus:paymentStatus, 
                productGroupSelect:productGroupSelect,
                additionalServices:additionalServices,
                fulfilment:fulfilment,
                search:search
            };
            var str = $.param( params );
            return str;
        }


        $(".select-show input").click(function () {
            if($(this).hasClass("all")){
                $(this).closest(".filter-block").find("input").each(function () {
                    if (this.checked && !$(this).hasClass("all")) {
                       $(this).attr('checked', false);
                    } 
                })
            }

                var selectedValues = [];
                $(this).closest(".select-show").find("input").each(function () {
                     if (this.checked) {
                        var text = $(this).parent().next().text();
                        selectedValues.push(text); 
                        
                    }
                })
                        if(selectedValues.length === 0){
                            $(this).closest('.filter-block').find('.inner-select').val("All");
                            $(this).closest(".select-show").find(".select-show-done").addClass('passive');
                            
                        }else{
                            $(this).closest('.filter-block').find('.inner-select').val("");
                            $(this).closest('.filter-block').find('.inner-select').val(selectedValues.toString());
                            $(this).closest(".select-show").find(".select-show-done").removeClass('passive');
                        }
        });


        $(".paymentStatus-select").click(function () {

            if (!$(this).hasClass('open')) {

                $(this).next().fadeIn("fast")
            } else {
                $(this).next().hide();
            }
            $(this).toggleClass("open");


        });
        $(".productGroupSelect-select").click(function () {

            if (!$(this).hasClass('open')) {

                $(this).next().fadeIn("fast")
            } else {
                $(this).next().hide();
            }
            $(this).toggleClass("open");
        });

        $(".additionalServices-select").click(function () {

            if (!$(this).hasClass('open')) {

                $(this).next().fadeIn("fast")
            } else {
                $(this).next().hide();
            }
            $(this).toggleClass("open");
        });


        $(".select-show-cancel").click(function () {
            $(this).closest('.select-show').prev().removeClass('open').next().hide()
        });




        $(".checkSingle").click(function () {
            if ($(this).attr('checked') !== "checked") {
                $(this).attr('checked', true);
            }else{
                $(this).attr('checked', false); 
            }
        }); 

        $("#checkedAll").change(function () {
            if (this.checked) {
                $(".checkSingle").each(function () {
                    this.checked = true;
                    $(this).attr('checked', true);
                    $(this).parent().parent().parent().addClass('grey-row')
                })
            } else {
                $(".checkSingle").each(function () {
                    this.checked = false;
                    $(this).attr('checked', false);
                    $(this).parent().parent().parent().removeClass('grey-row')
                })
            }
            checkAll();
        });

        $(".checkSingle").change(function () {
            if (this.checked) {
                $(this).parent().parent().parent().addClass('grey-row')
            } else {
                $(this).parent().parent().parent().removeClass('grey-row')
            }
            
            checkAll();

        });

        function checkAll() {
            var boxes = $('.checkSingle');
            var checkedd = 0;
            boxes.each(function () {
                if (this.checked === true) {
                    checkedd = checkedd + 1;
                }
            })
            $('.items-selected span').text(checkedd)
        }

var settings = {
    "startDate": moment(),
    "endDate": moment().add(7,'days'),
     "locale": {
      format: 'DD MMM'
    }
}




        $('#datepicker').daterangepicker(settings, function (start, end, label) {

            var year  = start.format('YYYY');
            var month = start.format('MM').replace(/^0+/, '');
            var day = start.format('DD').replace(/^0+/, '');

            var year_end  = end.format('YYYY');
            var month_end = end.format('MM').replace(/^0+/, '');
            var day_end = end.format('DD').replace(/^0+/, '');

            $("#datepicker_start_year").val(year);
            $("#datepicker_start_month").val(month);
            $("#datepicker_start_day").val(day);

            $("#datepicker_finish_year").val(year_end);
            $("#datepicker_finish_month").val(month_end);
            $("#datepicker_finish_day").val(day_end);

            $("#datepicker_total").val(year + "/" + month + "/" + day + "-" + year_end + "/" + month_end + "/" + day_end);


            console.log('New date range selected: ' + start.format('DD') + ' to ' + end.format('YYYY-MM-DD') + ' (predefined range: ' + label + ')');
        });

            var year  = moment().format('YYYY');
            var month = moment().format('MM').replace(/^0+/, '');
            var day = moment().format('DD').replace(/^0+/, '');

            var year_end  = moment().add(7,'days').format('YYYY');
            var month_end = moment().add(7,'days').format('MM').replace(/^0+/, '');
            var day_end = moment().add(7,'days').format('DD').replace(/^0+/, '');

            $("#datepicker_start_year").val(year);
            $("#datepicker_start_month").val(month);
            $("#datepicker_start_day").val(day);

            $("#datepicker_finish_year").val(year_end);
            $("#datepicker_finish_month").val(month_end);
            $("#datepicker_finish_day").val(day_end);

            $("#datepicker_total").val(year + "/" + month + "/" + day + "-" + year_end + "/" + month_end + "/" + day_end);
            console.log('New date range selected:');




    });



</script>