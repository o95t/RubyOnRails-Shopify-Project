
# Shopify Aramex Rails app Documentation

This is a Ruby on Rails Application which lets Shopify customers interact with Aramex. The application serves as a bridge between the Shopify and Aramex APIs.


### Edited by Imran Shaikh

Some sort of useful thing which is covered in this url
https://coderwall.com/p/yz8cha

### Developed By

Rohit Mishra
[rohit@rohitmishra.me](mailto:rohit@rohitmishra.me)

### Basic Information

* The application is written on **Ruby on Rails 3.2.13** and is developed on **Ruby 2.0.0-p0**
* This application has the following functionalities: **Creating Shipments, Creating Pickups, Tracking Shipments and Rate Calculator.**
* The WSDL files for the Aramex API is located in the `public/wsdl` folder. The filenames are hardcoded in the `application/config.html.erb` which must be updated when the filenames are changed.
* The Shopify API values are present in `config/initializers/omniauth.rb`
* The app is dependent on the Shopify_API, Omniauth and Savon gems among others. Please see the `Gemfile` for all the gems.

### Requirements from Shopify customers

* They need to add their Aramex information when they first authenticate the Aramex app with their Shopify shop.
* They must specify weights of their products in their Shopify admin.
* They must fulfil all the line items of an order together in one shipment.

### Code Documentation

* The code documentation is generated using Yard and is available at `doc/index.html`
* The documentation can be always regenerated by first installing the `yard` gem using `gem install yard` and then running `yard doc`
* For any clarifications, please contact the developer.

### Deployment
==============

# Instructions to install shopify_aramex on a Ubuntu (Linux) VPS

ssh shopify@125.22.54.223

# Switch to root user
sudo -s

# Update system. Install git

apt-get -y update
apt-get -y install curl git-core python-software-properties

# Install nginx

add-apt-repository ppa:nginx/stable
apt-get -y update
apt-get -y install nginx
service nginx start

# Amol installed mysql
# I only ran

mysql_secure_installation

# Node.js
add-apt-repository ppa:chris-lea/node.js
apt-get -y update
apt-get -y install nodejs

# Add a new user with root priviledges

adduser deployer --ingroup sudo
# (Press enter enter and Y at last)
# Password is same as shopify user

su deployer
cd ~

# Install rbenv

curl -L https://raw.github.com/fesplugas/rbenv-installer/master/bin/rbenv-installer | bash

# Add rbenv to load path before these lines in .bashrc

# If not running interactively, don't do anything
[ -z "$PS1" ] && return

# Before the above 2 lines, you need to add

export RBENV_ROOT="${HOME}/.rbenv"

if [ -d "${RBENV_ROOT}" ]; then
  export PATH="${RBENV_ROOT}/bin:${PATH}"
  eval "$(rbenv init -)"
fi

# Reload .bashrc

. ~/.bashrc

# Install ruby dependency packages
rbenv bootstrap-ubuntu-12-04

# Install ruby 2.0
rbenv install 2.0.0-p0

# Set ruby 2.0.0 as global ruby
rbenv global 2.0.0-p0

# Check if this command shows 2.0.0
ruby -v

# Install bundler
gem install bundler --no-ri --no-rdoc
rbenv rehash

# See what this shows
bundle -v

# Create production database and a user for it
mysql -u root -h localhost -p
# Give the root password

# on mysql prompt
create database shopify_aramex_production;
create user shopify;
grant all on shopify_aramex_production.* to 'shopify'@'localhost' identified by 'shopify@123';
exit

# Add mysql ruby dependencies
sudo apt-get install libmysql-ruby libmysqlclient-dev

# On client (should have git)
============

# Add the ip address to server line in config/deploy.rb

# Make this script executable
chmod +x config/unicorn_init.sh

# Commit all changes
git add .
git commit -m "Deployment config files"

# Run capistrano setup on your local
cap deploy:setup

# Now ssh in to server and edit the database.yml file present in ~/apps/shopify_aramex/shared/config/
# Edit the file to have this content
production:
  adapter: mysql2
  encoding: utf8
  database: shopify_aramex_production
  pool: 5
  host: localhost
  username: shopify
  password: <password>
  timeout: 5000

# Now run
cap deploy:cold

# Delete symlink to default nginx site
sudo rm /etc/nginx/sites-enabled/default
sudo service nginx restart
sudo update-rc.d unicorn_shopify_aramex defaults

# Installing MEMCACHED for api Countries fetching
sudo apt-get install memcached
#Checking Memcached status
sudo service memcached status

# Checking pid of memcached
ps aux |grep memcached 

# Flush Memcached from rails console
Rails.cache.clear